<html>
<head>
	<title>Spnego JWT</title>	
</head>

<body>
	<h2>This is a demo for Spnego JWT Token</h2>
	
	It used Spnego protocol to authenticate user, then generate JWT Token<br/> <br/>
	
	Then it will redirect to original request, or home page if no original request:<br/> <br/>
	
	 UserName: <label id=userName></label><br/>
	 TokenKey: <label id=tokenKey></label><br/>
	 CreatedTime: <label id=createdTime></label><br/>
	 ExpiredTime: <label id=expiredTime></label><br/>
	 JWTToken: <textarea id=JWTToken cols="100" rows="5" readonly="readonly"></textarea><br/>
	 
	 <br/><br/><br/>
	 
	 <a href="JWTToken" target="_blank">JWT Token</a>
	 
<script>
(function() {
	'use strict';

	var request = new XMLHttpRequest()

	request.open('GET', '/spnego/JWTToken', true)

	request.onload = function() {
		
		console.log("got JWT token...");
		
		if(window.self !== window.top){
			// in a frame, so send event corss origins
	        window.parent.postMessage(this.response, "*");  // last parameter means which domain
	        // postMessage can send event cross origins and popups, dispatchEvent can't
		}
		 
		var data = JSON.parse(this.response);
		document.getElementById("userName").innerHTML  = data.userName;
		document.getElementById("tokenKey").innerHTML  = data.keyId;
		var date = new Date(data.JWTCreated);
		document.getElementById("createdTime").innerHTML = date.toString();
		date = new Date(data.JWTExpired);
		document.getElementById("expiredTime").innerHTML = date;
		document.getElementById("JWTToken").value = data.JWTToken;
	}
	
	request.send()

}()); 

</script>
</body>
</html>
