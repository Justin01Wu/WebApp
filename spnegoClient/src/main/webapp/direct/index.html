<html>
<head>
	<title>direct token</title>	
</head>

<body>
	<h2>This is a demo for how to directly get token from Spnego auth center</h2>
	
	JavaScript will directly call a http GET to get JWT Token:<br/> <br/>
	
	 UserName: <label id=userName></label><br/>
	 TokenKey: <label id=tokenKey></label><br/>
	 CreatedTime: <label id=createdTime></label><br/>
	 ExpiredTime: <label id=expiredTime></label><br/>
	 JWTToken: <textarea id=JWTToken cols="100" rows="5" readonly="readonly"></textarea><br/>
	 
	 <br/><br/><br/>
	 <button onclick="getToken2()">get token3</button>
	 
<script>


	//var tokenUrl = "http://uspasicsapts01:8380/spnego/JWTToken";
	//var tokenUrl = "http://CA09417D:8380/spnego/JWTToken";
	var tokenUrl = "http://uspasicsapts01:8380/spnego/JWTToken";
	
	function getToken(){
		var request = new XMLHttpRequest()

		request.open('GET', tokenUrl, true);		
		// target server enabled CORS, but Spnego can't corss origins, so doesn't work		

		request.onload = function() {			 
			var data = JSON.parse(this.response);			
			setTokenOnUi(data);
		}
		
		request.send();
		
	}
	
	function setTokenOnUi(data){

		document.getElementById("userName").innerHTML  = data.userName;
		document.getElementById("tokenKey").innerHTML  = data.keyId;
		var date = new Date(data.JWTCreated);
		document.getElementById("createdTime").innerHTML = date.toString();
		date = new Date(data.JWTExpired);
		document.getElementById("expiredTime").innerHTML = date;
		document.getElementById("JWTToken").value = data.JWTToken;
	}
	
	function getToken2(){
		var iframe = document.getElementById("dajalsdj1234");	
		if(!iframe){
			iframe = document.createElement('iframe');			
			iframe.style="display:none";
			iframe.id="dajalsdj1234";
		}
		//iframe.src = "http://localhost:8380/spnego/";
		iframe.src = "http://uspasicsapts01:8380/spnego/";
		
		document.body.appendChild(iframe); // add it to wherever you need it in the document
	}
	
	window.addEventListener('message',function(event) {
		//if(event.origin !== 'http://uspasicsapts01:8380') return;
		console.log('message received:  ', event.data);
		var data = JSON.parse(event.data);
		setTokenOnUi(data);
		//event.source.postMessage('holla back youngin!',event.origin);
		
		
	},false);
	
	

 

</script>
</body>
</html>
